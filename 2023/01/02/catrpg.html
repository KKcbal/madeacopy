<!DOCTYPE html>

<html lang="en-US">
<head>
  <title>Not Bubsy 3D</title>
<style>
  .flex-container {
    display: flex;
    justify-content: center;
  }

  .flex-container > div {
    background-color: black;
    font-family: 'Courier New';
    color: rgb(6, 240, 6);
    text-align: center;
    margin: 10px;
    padding: 20px;
    font-size: 30px;
    align-items: flex-end;
  }
  .terminalbox {
    display: flex;
    align-items: flex-end;
    overflow: hidden;
  }
  .terminalbox > p {
    font-family: 'Courier New';
    color: rgb(6, 240, 6);
    text-align: left;
    margin: 10px;
    padding: 20px;
    font-size: 20px;
    overflow: hidden;
  }
  .terminalbox > div {
    font-family: 'Courier New';
    color: rgb(6, 240, 6);
    text-align: left;
    margin: 10px;
    padding: 20px;
    font-size: 20px;
    overflow: hidden;
  }

  .flex-container2 {
    display: flex;
    justify-content: space-around;
  }

  .flex-container2 > input {
    background-color: black;
    font-family: 'Courier New';
    color: rgb(6, 240, 6);
    margin: 10px;
    padding: 20px;
    font-size: 30px;
  }
</style>
</head>
<body>
    <p id="no"></p>

  <div class="flex-container" style="height: 400px;">
    <div style="flex-grow: 1;flex-shrink: 0;background-color: White;"></div>
    <div id="emptu" class="terminalbox" style="flex-grow: 8">
        <p id="terminal">THIS IS THE TERMINAL <br> TYPE "PLAY" TO PLAY</p>
    </div>
    <div style="flex-grow: 1;flex-shrink: 0;background-color: White;"></div>  
  </div>

  <div class="flex-container2">
    <div style="flex-grow: 1;flex-shrink: 0;background-color: White;"></div>
    <input class="uc-text-smooth" type="text" id="textinput" style="flex-grow: 4;"></input>
    <div style="flex-grow: 1;flex-shrink: 0;background-color: White;"></div>
  </div>

  <script>
  const forceKeyPressUppercase = (e) => {
    let el = e.target;
    let charInput = e.keyCode;
    if((charInput >= 97) && (charInput <= 122)) { // lowercase
      if(!e.ctrlKey && !e.metaKey && !e.altKey) { // no modifier key
        let newChar = charInput - 32;
        let start = el.selectionStart;
        let end = el.selectionEnd;
        el.value = el.value.substring(0, start) + String.fromCharCode(newChar) + el.value.substring(end);
        el.setSelectionRange(start+1, start+1);
        e.preventDefault();
      }
    }
  };

  document.querySelectorAll(".uc-text-smooth").forEach(function(current) {
    current.addEventListener("keypress", forceKeyPressUppercase);
  });
  </script>
  <script>
    let doc = document;
    let terminallimit = "13 lines";
    let gamestate = "0"
    let phealth = 3;
    let ophealth = 3;
    let time = 0;
    let points = 0;
    const party = [0, 0, 0, 0]
    let encountercountdown = 2
    let levelcount = 0
    let inpbox = document.getElementById("textinput");
    let uinp = document.getElementById("textinput").value;

    inpbox.addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
        uinp = document.getElementById("textinput").value;
        enter();
        document.getElementById("textinput").value = ""
      }
    });
    
    function timeincrease() {time++}
    function terminaltext() {
      return document.getElementById("terminal").innerHTML
    }
    function attack(health) {
      health = health - 1;
    }
    function writeterm(inputtext) {
      doc.getElementById("terminal").innerHTML = terminaltext() + "<br>" + inputtext
    }
    function grabinput() {
      let userchoice = doc.getElementById("textinput").value;
      return userchoice
    }
    function enter() {
      if (gamestate == "0") {
        gamestate0()
      } else if (gamestate == "1") {
        turn()
      } else if (gamestate == "-1") {
        win1()
      } 
    }
    function gamestate0() {
      if (uinp == "PLAY") {
        writeterm("THE GAME HAS BEGUN")
        setInterval(timeincrease, 1000)
        gamestate = "1"
      } else {
        writeterm('TYPE "PLAY" TO PLAY')
      }
    }
    function playerturn(){
      if (uinp == "ATTACK") {
        attack(ophealth)
      } else if (uinp == "PERSONA") {
        writeterm("YOU CAN'T CHANGE PERSONAS")
      } else if (uinp == "CHECK") {
        writeterm("PLAYER HEALTH: " + phealth)
        writeterm("OPPONENT HEALTH: " + ophealth)
      } else if (uinp = "WIN") {
        gamestate = "-1"
      } else if (uinp = "TIME") {
        writeterm("TIME: " + time)
      } else {}
    }
    function turn() {
      playerturn()
    }
    function win1() {
      let partywincount = 0
      if (party[0] == 1) {
        partywincount += 1
      }
      if (party[1] == 1) {
        partywincount += 1
      }
      if (party[2] == 1) {
        partywincount += 1
      }
      if (party[3] == 1) {
        partywincount += 1
      }
      if (partywincount == 0) {
        points += 100
      } else if (partywincount == 1) {
        points += 75
      } else if (partywincount == 2) {
        points += 50
      } else if (partywincount == 3) {
        points += 25
      } else {points += 10}
      writeterm("CONGRATULATIONS, YOU WON!")
      writeterm("YOUR TIME: " + time)
      writeterm("YOUR HEALTH: " + health)
      writeterm("YOUR POINTS: " + points)
      writeterm("YOU HAVE " + partywincount + " PARTY MEMBERS OUT OF 4")
    }
  </script>
</body>
</html>
